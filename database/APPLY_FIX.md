# ุชุทุจูู ุฅุตูุงุญ ุงูุจุงุฑููุฏ ุงููุชูุฑุฑ

## ุฎุทูุงุช ุณุฑูุนุฉ

### โ ุงูุฅุตูุงุญ ูุทุจู ุจุงููุนู!

ุฅุฐุง ุธูุฑ ูู ุฎุทุฃ:

```
#1091 - Can't DROP INDEX `barcode`; check that it exists
```

**ูุฐุง ูุนูู ุฃู ุงูุฅุตูุงุญ ูุทุจู ุจุงููุนู!** ุงูููุฏ UNIQUE ุชู ุญุฐูู ูุณุจูุงู. โ

---

### ๐งช ุชุญูู ูู ุงูุฅุตูุงุญ (ูู phpMyAdmin)

1. ุงูุชุญ phpMyAdmin: http://localhost/phpmyadmin
2. ุงุฎุชุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช `attendance_app` ูู ุงููุงุฆูุฉ ุงููุณุฑู
3. ุงุถุบุท ุนูู ุชุจููุจ **SQL** ูู ุงูุฃุนูู
4. ุงูุณุฎ ูุงูุตู ูุฐุง ุงูููุฏ ููุงุฎุชุจุงุฑ:

```sql
USE attendance_app;

-- ุงุฎุชุจุงุฑ: ุฃุถู ูุนุงููุชูู ุจููุณ ุงูุจุงุฑููุฏ
INSERT INTO events (name, type, date, barcode, description) VALUES
('ุงุฎุชุจุงุฑ 1', 'mass', '2025-10-13 09:00:00', 'TEST_001', 'ุงุฎุชุจุงุฑ'),
('ุงุฎุชุจุงุฑ 2', 'mass', '2025-10-20 09:00:00', 'TEST_001', 'ุงุฎุชุจุงุฑ');

-- ุฅุฐุง ูุฌุญ ุจุฏูู ุฃุฎุทุงุก - ุงูุฅุตูุงุญ ูุนูู! โ
SELECT 'ุงูุฅุตูุงุญ ูุนูู ุจูุฌุงุญ!' AS Status;

-- ุชูุธูู
DELETE FROM events WHERE barcode = 'TEST_001';
```

5. ุงุถุบุท **ุชูููุฐ** (Execute) ุฃู **Go**

**ุฅุฐุง ุนูู ุจุฏูู ุฃุฎุทุงุก - ูู ุดูุก ุชูุงู!** โ

### ุงูุทุฑููุฉ 2: ูู MySQL Command Line

1. ุงูุชุญ Command Prompt ุฃู PowerShell
2. ููุฐ:

```bash
cd d:\Projects\osret_elkdes_oghostinos\database
mysql -u root -p attendance_app < fix_barcode_and_scan_history.sql
```

## ุงูุชุญูู ูู ุงูุชุทุจูู

### 1. ุชุญูู ูู ุฅุฒุงูุฉ UNIQUE

ูู phpMyAdmin ุฃู MySQL CLI:

```sql
SHOW CREATE TABLE events;
```

ูุฌุจ **ุฃูุง** ุชุฑู `UNIQUE KEY` ููุจุงุฑููุฏ.

### 2. ุฌุฑุจ ุฅุถุงูุฉ ูุนุงููุงุช ุจููุณ ุงูุจุงุฑููุฏ

```sql
INSERT INTO events (name, type, date, barcode, description)
VALUES
('ูุฏุงุณ ุงูุฃุญุฏ - 1', 'mass', '2025-10-13 09:00:00', 'TEST_001', 'ุงุฎุชุจุงุฑ'),
('ูุฏุงุณ ุงูุฃุญุฏ - 2', 'mass', '2025-10-20 09:00:00', 'TEST_001', 'ุงุฎุชุจุงุฑ');
```

ูุฌุจ ุฃู ูุนูู **ุจุฏูู ุฃุฎุทุงุก**.

### 3. ุงุฎุชุจุฑ ูู ููุญุฉ ุงูุชุญูู

1. ุงูุชุญ: http://127.0.0.1:8080/dashboard/attendance_api/admin/login.html
2. ุณุฌู ุฏุฎููู
3. ุงุฐูุจ ูุชุจููุจ **ุงููุนุงููุงุช**
4. ุงุถุบุท **+ ุฅุถุงูุฉ ูุนุงููุฉ**
5. ุงููุฃ ุงูุจูุงูุงุช
6. ุงุถุบุท **ุญูุธ**

ูุฌุจ ุฃู ุชุถุงู ุงููุนุงููุฉ **ุจุฏูู ุฎุทุฃ created_by**.

## ุฅุฐุง ุธูุฑุช ุฃุฎุทุงุก

### ุฎุทุฃ: "Duplicate key name 'idx_barcode'"

**ูุนูุงูุง:** ุงูู index ุงูุนุงุฏู `idx_barcode` ููุฌูุฏ ุจุงููุนู (ููุฐุง ุฌูุฏ!)

**ุงูุญู:** ูุง ุชูุนู ุดูุก! ููุท ุงุญุฐู ุงูู UNIQUE index:

```sql
-- ููุท ุงุญุฐู barcode (ุงูู UNIQUE)
ALTER TABLE events DROP INDEX barcode;
```

**idx_barcode ููุฌูุฏ ุจุงููุนู ูู schema.sql ุงูุฃุตููุ ูุฐูู ูุง ุชุญุชุงุฌ ูุฅุถุงูุชู ูุฑุฉ ุฃุฎุฑู.**

### ุฎุทุฃ: "Can't DROP 'barcode'; check that column/key exists"

**ูุนูุงูุง:** ุงูููุฏ UNIQUE ุชู ุญุฐูู ูุณุจูุงู - ูู ุดูุก ุชูุงู! โ

**ุงูุญู:** ูุง ุชูุนู ุดูุกุ ุงูุฅุตูุงุญ ูุทุจู ุจุงููุนู.

### ุฎุทุฃ: "Duplicate entry 'XXX' for key 'barcode'"

**ูุนูุงูุง:** ุงูููุฏ UNIQUE ูุง ูุฒุงู ููุฌูุฏ ููููุน ุงูุชูุฑุงุฑ

**ุงูุญู:** ุงุญุฐูู:

```sql
ALTER TABLE events DROP INDEX barcode;
```

## ููุฎุต ุงูุฅุตูุงุญุงุช

โ **PHP Files:**

- `api/add_event.php` - ุญุฐู created_by ู barcode uniqueness check
- `api/update_event.php` - ุญุฐู barcode uniqueness check

โ **Database:**

- `schema.sql` - ุชุญุฏูุซ: ุญุฐู UNIQUE ูู barcode
- `fix_barcode_and_scan_history.sql` - ุณูุฑูุจุช ุงูุฅุตูุงุญ

โ **ุงูุขู ูููู:**

- ุฅุถุงูุฉ ูุนุงููุงุช ุจููุณ ุงูุจุงุฑููุฏ
- ุชุณุฌูู ุญุถูุฑ ูุชูุฑุฑ ูุน timestamp ุชููุงุฆู
- ุชุชุจุน ุชุงุฑูุฎ ุงููุณุญ ููู ูุณุชุฎุฏู
